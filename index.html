<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Beer Editor</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.min.js"></script>
  <script src="https://rawgit.com/homebrewing/brauhausjs/master/dist/brauhaus.min.js"></script>
  <script src="https://rawgit.com/homebrewing/brauhaus-styles/master/dist/brauhaus-styles.min.js"></script>
  <script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-1.3.2.js"></script>
  <script src="beer-editor.js"></script>
  <script src="app.js"></script>
</head>
<body ng-controller="BeerEditorController">

<div class="container">

  <div class="form-group">
    <input placeholder="Titre" ng-model="recipe.name" class="form-control input-lg" />
  </div>

  <div class="form-group">
    <div class="row">
      <div class="col-md-8">
        <input placeholder="Description" class="form-control"
               ng-model="recipe.description" />
      </div>

      <div class="col-md-4">
        <div class="btn-group btn-group-justified">
          <div class="btn-group" uib-dropdown>
            <button class="btn btn-default" uib-dropdown-toggle style="text-align: right;">
              <span class="pull-left">{{ recipe.style.name || 'Choisir un style' }}</span>
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" uib-dropdown-menu>
              <li ng-repeat-start="category in bh.getStyleCategories()"
                  class="dropdown-header">{{ category }}</li>
              <li ng-repeat-end ng-repeat="style in bh.getStyles(category)">
                <a ng-click="recipe.style = bh.getStyle(category, style)">
                  {{ style }}
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="btn-group" uib-dropdown>
      <button class="btn btn-default" uib-dropdown-toggle>
        <span class="glyphicon glyphicon-plus-sign"></span>
        Malts
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" uib-dropdown-menu>
        <li ng-repeat="item in fermentables">
          <a ng-click="addFermentable(recipe, item)">
            <span class="glyphicon glyphicon-grain"
                  ng-style="{'color': bh.srmToCss(bh.ebcToSrm(item.color))}"></span>
            {{ item.name }}
          </a>
        </li>
      </ul>
    </div>
    
    <div class="btn-group" uib-dropdown>
      <button class="btn btn-default" uib-dropdown-toggle>
        <span class="glyphicon glyphicon-plus-sign"></span>
        Houblons
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" uib-dropdown-menu>
        <li ng-repeat="item in spices">
          <a ng-click="addSpice(recipe, item)">
            <span class="glyphicon glyphicon-leaf"
                  style="color: #afa;"></span>
            {{ item.name }}
          </a>
        </li>
      </ul>
    </div>
    
    <div class="btn-group" uib-dropdown>
      <button class="btn btn-default" uib-dropdown-toggle>
        <span class="glyphicon glyphicon-plus-sign"></span>
        Levures
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" uib-dropdown-menu>
        <li ng-repeat="item in yeast">
          <a ng-click="recipe.yeast.push(copy(item));">
            <span class="glyphicon glyphicon-record"
                  style="color: #aaa;"></span>
            {{ item.name }}
          </a>
        </li>
      </ul>
    </div>

    <button class="btn btn-danger pull-right" ng-click="clear()">
      <span class="glyphicon glyphicon-remove"></span>
      Effacer
    </button>
  </div>

  <div class="row">
    <div class="col-sm-9">
      <table class="table" ng-show="numberOfIngredients(recipe) > 0">
        <thead>
          <th class="col-md-1"></th>
          <th class="col-md-4">Nom</th>
          <th class="col-md-1">Format</th>
          <th class="col-md-1 text-right">%&alpha;</th>
          <th class="col-md-1">Moment</th>
          <th class="col-md-1 text-right">Durée</th>
          <th class="col-md-1 text-right">Quantité</th>
          <th class="col-md-1 text-right">%/IBU</th>
          <th class="col-md-1"></th>
        </thead>
        <tbody>
          <!-- Fermentables -->
          <tr ng-repeat="item in recipe.fermentables">
            <td>
              <span class="form-control">
                <span class="glyphicon glyphicon-grain"
                      ng-style="{'color': bh.srmToCss(bh.ebcToSrm(item.color))}"></span>
              </span>
            </td>
            <td>
              <input class="form-control" ng-model="item.name" />
            </td>
            <td colspan="4"></td>
            <td>
              <div class="has-feedback">
                <input type="number" step="any" class="form-control text-right"
                       ng-model="item.weight"
                       ng-blur="recipe.fermentables = orderBy(recipe.fermentables, ['-weight','color','name'])" />
                <span class="form-control-feedback">kg</span>
              </div>
            </td>
            <td>
              <div class="has-feedback">
                <span class="form-control text-right">
                  {{ ((item.weight / recipeWeight(recipe) * 100) || 0) | number:0 }}
                </span>
                <span class="form-control-feedback">%</span>
              </div>
            </td>
            <td class="text-right">
              <div class="form-control">
                <a class="action text-danger" ng-click="remove(recipe.fermentables, item)">
                  <span class="glyphicon glyphicon-remove-sign"></span>
                </a>
              </div>
            </td>
          </tr>
          <!-- Spices -->
          <tr ng-repeat="item in recipe.spices">
            <td>
              <span class="form-control">
                <span class="glyphicon glyphicon-leaf" style="color: #8c8;"></span>
              </span>
            </td>
            <td>
              <input class="form-control" ng-model="item.name" />
            </td>
            <td>
              <div class="form-control">
                <div class="btn-group btn-group-xs" uib-dropdown>
                  <button class="btn btn-default" uib-dropdown-toggle>
                    {{ spiceFormats[item.format] }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" uib-dropdown-menu>
                    <li ng-repeat="(format, name) in spiceFormats">
                      <a ng-click="item.format = format">{{ name }}</a>
                    </li>
                  </ul>
                </div>
              </div>
            </td>
            <td>
              <div class="has-feedback">
                <input type="number" step="any" class="form-control text-right"
                       ng-model="item.aa" />
                <span class="form-control-feedback">%</span>
              </div>
            </td>
            <td>
              <div class="form-control">
                <div class="btn-group btn-group-xs" uib-dropdown>
                  <button class="btn btn-default" uib-dropdown-toggle>
                    {{ spiceMoments[item.moment] }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" uib-dropdown-menu>
                    <li ng-repeat="(moment, name) in spiceMoments">
                      <a ng-click="item.moment = moment">{{ name }}</a>
                    </li>
                  </ul>
                </div>
              </div>
            </td>
            <td>
              <div class="has-feedback">
                <input type="number" step="any" class="form-control text-right"
                       ng-model="item.time"
                       ng-blur="recipe.spices = orderBy(recipe.spices, ['-time','weight','name'])" />
                <span class="form-control-feedback">mn</span>
              </div>
            </td>
            <td>
              <div class="has-feedback">
                <input type="number" step="any" class="form-control text-right"
                       ng-model="item.weight" />
                <span class="form-control-feedback">g</span>
              </div>
            </td>
            <td>
              <div class="has-feedback">
                <span class="form-control text-right">
                  {{ spiceBitterness(item, calculations) | number:1 }}
                </span>
                <span class="form-control-feedback">IBU</span>
              </div>
            </td>
            <td>
              <div class="form-control text-right">
                <a class="action text-danger" ng-click="remove(recipe.spices, item)">
                  <span class="glyphicon glyphicon-remove-sign"></span>
                </a>
              </div>
            </td>
          </tr>
          <!-- Yeast -->
          <tr ng-repeat="item in recipe.yeast">
            <td>
              <span class="form-control">
                <span class="glyphicon glyphicon-record" style="color: #aaa;"></span>
              </span>
            </td>
            <td colspan="7">
              <input class="form-control" ng-model="item.name" />
            </td>
            <td>
              <div class="form-control text-right">
                <a class="action text-danger" ng-click="remove(recipe.yeast, item)">
                  <span class="glyphicon glyphicon-remove-sign"></span>
                </a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="col-md-3">
      <dl class="dl-horizontal">
        <dt>Volume final</dt>
        <dd>
          <div class="has-feedback">
            <input type="number" step="any" class="form-control text-right"
                   ng-model="recipe.batchSize" />
            <span class="form-control-feedback">L</span>
          </div>
        </dd>
        <dt>Densité initiale</dt>
        <dd>{{ calculations.og | number:3 }}</dd>
        <dt>Densité finale</dt>
        <dd>{{ calculations.fg | number:3 }}</dd>
        <dt>Couleur</dt>
        <dd>
          <div class="has-feedback">
            <span style="display:inline-block; width: 1em; height: 1em;"
                  ng-style="{'background-color': bh.srmToCss(calculations.color)}"></span>
            {{ bh.srmToEbc(calculations.color) | number:0 }} EBC
          </div>
        </dd>
        <dt>Alcool</dt>
        <dd>{{ calculations.abv | number:1 }}%</dd>
        <dt>Amertume Absolue</dt>
        <dd>{{ calculations.ibu | number:1 }} IBU</dd>
        <dt>Amertume Relative</dt>
        <dd>{{ calculations.buToGu | number:1 }} BU:GU</dd>
      </dl>
    </div>
  </div>

  <ng-include src="'equipment.html'"></ng-include>

</div>

</body>
</html>
